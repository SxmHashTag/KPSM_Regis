{% extends 'base.html' %}

{% block title %}Dashboard - Diamond Forensics{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Page Header -->
    <div class="flex justify-between items-center">
        <div>
            <h2 class="text-3xl font-bold text-foreground">Dashboard</h2>
            <p class="text-muted-foreground mt-1">Overview of forensics investigations</p>
        </div>
    </div>
    
    <!-- Global Search -->
    <div class="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-lg border-2 border-indigo-200 p-6 shadow-sm">
        <form method="get" class="flex gap-2">
            <div class="relative flex-1">
                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <input type="text" name="search" value="{{ search|default:'' }}" 
                    placeholder="Search across all cases, persons, and evidence..." 
                    class="w-full pl-10 pr-4 py-3 border-2 border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 text-lg bg-white">
            </div>
            <button type="submit" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-md">
                Search
            </button>
            {% if search %}
            <a href="{% url 'dashboard' %}" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium shadow-md">
                Clear
            </a>
            {% endif %}
        </form>
    </div>
    
    <!-- Search Results -->
    {% if search_results %}
    <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg border-2 border-purple-200 p-6 shadow-md">
        <h3 class="text-xl font-semibold text-foreground mb-4">
            Search Results for "{{ search }}" 
            <span class="text-muted-foreground text-base font-normal">({{ search_results.total }} results)</span>
        </h3>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Cases Results -->
            <div>
                <h4 class="text-sm font-semibold text-foreground mb-3 flex items-center gap-2">
                    <span class="w-2 h-2 bg-primary rounded-full"></span>
                    Cases ({{ search_results.cases.count }})
                </h4>
                <div class="space-y-2">
                    {% for case in search_results.cases %}
                    <a href="{% url 'case_detail' case.pk %}" class="block p-3 rounded-lg border border-border hover:bg-secondary/50 transition-colors">
                        <p class="font-medium text-foreground text-sm">{{ case.case_number }}</p>
                        <p class="text-xs text-muted-foreground">{{ case.case_name }}</p>
                    </a>
                    {% empty %}
                    <p class="text-xs text-muted-foreground">No cases found</p>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Persons Results -->
            <div>
                <h4 class="text-sm font-semibold text-foreground mb-3 flex items-center gap-2">
                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                    Persons ({{ search_results.persons.count }})
                </h4>
                <div class="space-y-2">
                    {% for person in search_results.persons %}
                    <div class="block p-3 rounded-lg border border-border hover:bg-secondary/50 transition-colors">
                        <p class="font-medium text-foreground text-sm">{{ person.first_name }} {{ person.last_name }}</p>
                        <p class="text-xs text-muted-foreground">{{ person.get_person_type_display }}</p>
                    </div>
                    {% empty %}
                    <p class="text-xs text-muted-foreground">No persons found</p>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Evidence Results -->
            <div>
                <h4 class="text-sm font-semibold text-foreground mb-3 flex items-center gap-2">
                    <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                    Evidence ({{ search_results.evidence.count }})
                </h4>
                <div class="space-y-2">
                    {% for item in search_results.evidence %}
                    <a href="{% url 'evidence_detail' item.pk %}" class="block p-3 rounded-lg border border-border hover:bg-secondary/50 transition-colors">
                        <p class="font-medium text-foreground text-sm">{{ item.evidence_number }}</p>
                        <p class="text-xs text-muted-foreground">{{ item.item_name }}</p>
                        {% if item.case %}
                        <span class="text-xs text-primary">{{ item.case.case_number }}</span>
                        {% endif %}
                    </a>
                    {% empty %}
                    <p class="text-xs text-muted-foreground">No evidence found</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <div class="mt-6 pt-4 border-t border-border flex gap-2">
            <a href="{% url 'case_list' %}?search={{ search }}" class="text-sm text-primary hover:underline">View all cases →</a>
            <span class="text-muted-foreground">•</span>
            <a href="{% url 'person_list' %}?search={{ search }}" class="text-sm text-primary hover:underline">View all persons →</a>
            <span class="text-muted-foreground">•</span>
            <a href="{% url 'evidence_list' %}?search={{ search }}" class="text-sm text-primary hover:underline">View all evidence →</a>
        </div>
    </div>
    {% endif %}

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Total Cases -->
        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg p-6 hover:shadow-xl transition-shadow shadow-md">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-indigo-100">Total Cases</p>
                    <p class="text-3xl font-bold text-white mt-2">{{ total_cases }}</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Active Cases -->
        <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg p-6 hover:shadow-xl transition-shadow shadow-md">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-green-100">Active Cases</p>
                    <p class="text-3xl font-bold text-white mt-2">{{ active_cases }}</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Total Persons -->
        <div class="bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg p-6 hover:shadow-xl transition-shadow shadow-md">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-blue-100">Total Persons</p>
                    <p class="text-3xl font-bold text-white mt-2">{{ total_persons }}</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Total Evidence -->
        <div class="bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg p-6 hover:shadow-xl transition-shadow shadow-md">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-amber-100">Total Evidence</p>
                    <p class="text-3xl font-bold text-white mt-2">{{ total_evidence }}</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-gradient-to-r from-slate-700 to-slate-800 rounded-lg p-6 shadow-md">
        <h3 class="text-lg font-semibold text-white mb-4">Quick Actions</h3>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <a href="{% url 'case_create' %}" class="flex items-center gap-3 p-4 rounded-lg bg-white/10 border border-white/20 hover:bg-white/20 hover:border-indigo-400 transition-all">
                <div class="w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                </div>
                <div>
                    <p class="font-medium text-white">New Case</p>
                    <p class="text-xs text-slate-300">Create a new investigation</p>
                </div>
            </a>
            
            <a href="{% url 'person_create' %}" class="flex items-center gap-3 p-4 rounded-lg bg-white/10 border border-white/20 hover:bg-white/20 hover:border-blue-400 transition-all">
                <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                </div>
                <div>
                    <p class="font-medium text-white">Add Person</p>
                    <p class="text-xs text-slate-300">Register a new person</p>
                </div>
            </a>
            
            <a href="{% url 'evidence_list' %}" class="flex items-center gap-3 p-4 rounded-lg bg-white/10 border border-white/20 hover:bg-white/20 hover:border-amber-400 transition-all">
                <div class="w-10 h-10 bg-amber-500 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
                <div>
                    <p class="font-medium text-white">View Evidence</p>
                    <p class="text-xs text-slate-300">Browse evidence items</p>
                </div>
            </a>
            
            <a href="{% url 'analytics_dashboard' %}" class="flex items-center gap-3 p-4 rounded-lg bg-white/10 border border-white/20 hover:bg-white/20 hover:border-purple-400 transition-all">
                <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                </div>
                <div>
                    <p class="font-medium text-white">Analytics</p>
                    <p class="text-xs text-slate-300">View detailed reports</p>
                </div>
            </a>
        </div>
    </div>

    <!-- Monthly Activity Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg border border-blue-200 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-blue-700">Cases This Month</p>
                    <p class="text-3xl font-bold text-blue-900 mt-2">{{ cases_this_month }}</p>
                </div>
                <div class="w-12 h-12 bg-blue-200 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg border border-purple-200 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-purple-700">Evidence This Month</p>
                    <p class="text-3xl font-bold text-purple-900 mt-2">{{ evidence_this_month }}</p>
                </div>
                <div class="w-12 h-12 bg-purple-200 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-purple-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg border border-green-200 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-green-700">Cases Closed</p>
                    <p class="text-3xl font-bold text-green-900 mt-2">{{ cases_closed_this_month }}</p>
                </div>
                <div class="w-12 h-12 bg-green-200 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-green-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg border-2 border-blue-200 p-6 shadow-md">
        <h3 class="text-lg font-semibold text-blue-900 mb-4">Recent Activity</h3>
        <div class="space-y-2">
            {% for item in recent_activity %}
            <a href="{% url 'evidence_detail' item.pk %}" class="flex items-center gap-3 p-3 bg-white rounded-lg hover:bg-blue-100 transition-colors">
                {% if item.images.first %}
                <img src="{{ item.images.first.image.url }}" alt="{{ item.evidence_number }}" class="w-12 h-12 object-cover rounded border border-blue-200">
                {% else %}
                <div class="w-12 h-12 bg-gray-100 rounded flex items-center justify-center border border-gray-200">
                    <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
                    </svg>
                </div>
                {% endif %}
                <div class="flex-1 min-w-0">
                    <p class="font-semibold text-sm text-foreground truncate">{{ item.evidence_number }}</p>
                    <p class="text-xs text-muted-foreground truncate">{{ item.item_name }}</p>
                </div>
                <div class="text-right">
                    {% if item.current_department %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-700">{{ item.get_current_department_display }}</span>
                    {% endif %}
                    <p class="text-xs text-muted-foreground mt-1">{{ item.created_at|timesince }} ago</p>
                </div>
            </a>
            {% empty %}
            <p class="text-sm text-muted-foreground text-center py-4">No recent activity</p>
            {% endfor %}
        </div>
    </div>
    
    <!-- Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Case Status Distribution -->
        <div class="bg-gradient-to-br from-teal-50 to-cyan-50 rounded-lg border-2 border-teal-200 p-6 shadow-md">
            <h3 class="text-lg font-semibold text-teal-900 mb-4">Case Status Distribution</h3>
            <div class="h-64">
                <canvas id="caseStatusChart"></canvas>
            </div>
        </div>
        
        <!-- Evidence by Device Type -->
        <div class="bg-gradient-to-br from-violet-50 to-purple-50 rounded-lg border-2 border-violet-200 p-6 shadow-md">
            <h3 class="text-lg font-semibold text-violet-900 mb-4">Evidence by Device Type</h3>
            <div class="h-64">
                <canvas id="evidenceDeviceChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Department Inventory Stats -->
    <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg border-2 border-purple-200 p-6 shadow-md">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-purple-900">Department Inventory</h3>
            <a href="{% url 'evidence_location_search' %}" class="text-sm text-primary hover:underline">View all →</a>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            {% for dept_code, dept_data in department_stats.items %}
            <a href="{% url 'evidence_location_search' %}?department={{ dept_code }}" class="block p-4 bg-white rounded-lg border border-purple-200 hover:border-purple-400 hover:shadow-md transition-all">
                <p class="text-sm text-muted-foreground mb-1">{{ dept_data.name }}</p>
                <p class="text-2xl font-bold text-purple-900">{{ dept_data.count }}</p>
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Alert Widgets -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- High Priority Cases -->
        <div class="bg-orange-50 rounded-lg border-2 border-orange-200 p-6">
            <div class="flex items-center gap-2 mb-4">
                <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                <h3 class="text-lg font-semibold text-orange-900">High Priority Cases</h3>
            </div>
            <div class="space-y-2">
                {% for case in high_priority_cases %}
                <a href="{% url 'case_detail' case.pk %}" class="block p-3 bg-white rounded-lg hover:bg-orange-100 transition-colors">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-foreground">{{ case.case_number }}</p>
                            <p class="text-sm text-muted-foreground">{{ case.case_name }}</p>
                        </div>
                        <span class="px-2 py-1 text-xs font-medium rounded-full {% if case.priority == 'critical' %}bg-red-100 text-red-700{% else %}bg-orange-100 text-orange-700{% endif %}">
                            {{ case.get_priority_display }}
                        </span>
                    </div>
                </a>
                {% empty %}
                <p class="text-sm text-muted-foreground text-center py-4">No high priority cases</p>
                {% endfor %}
            </div>
        </div>
        
        <!-- Overdue Cases -->
        <div class="bg-red-50 rounded-lg border-2 border-red-200 p-6">
            <div class="flex items-center gap-2 mb-4">
                <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <h3 class="text-lg font-semibold text-red-900">Overdue Cases (90+ days)</h3>
            </div>
            <div class="space-y-2">
                {% for case in overdue_cases %}
                <a href="{% url 'case_detail' case.pk %}" class="block p-3 bg-white rounded-lg hover:bg-red-100 transition-colors">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-foreground">{{ case.case_number }}</p>
                            <p class="text-sm text-muted-foreground">{{ case.case_name }}</p>
                            <p class="text-xs text-red-600 mt-1">Opened: {{ case.date_opened|date:"M d, Y" }}</p>
                        </div>
                        <span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700">
                            Active
                        </span>
                    </div>
                </a>
                {% empty %}
                <p class="text-sm text-muted-foreground text-center py-4">No overdue cases</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Recent Cases -->
        <div class="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-lg border-2 border-indigo-200 p-6 shadow-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-indigo-900">Recent Cases</h3>
                <a href="{% url 'case_list' %}" class="text-sm text-indigo-600 hover:text-indigo-800 hover:underline">View all →</a>
            </div>
            <div class="space-y-3">
                {% for case in recent_cases %}
                <a href="{% url 'case_detail' case.pk %}" class="block p-3 rounded-lg hover:bg-secondary/50 transition-colors">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-foreground">{{ case.case_number }}</p>
                            <p class="text-sm text-muted-foreground">{{ case.case_name }}</p>
                        </div>
                        <span class="px-2 py-1 text-xs font-medium rounded-full
                            {% if case.status == 'active' %}bg-green-100 text-green-700
                            {% elif case.status == 'closed' %}bg-gray-100 text-gray-700
                            {% elif case.status == 'suspended' %}bg-yellow-100 text-yellow-700
                            {% else %}bg-blue-100 text-blue-700{% endif %}">
                            {{ case.get_status_display }}
                        </span>
                    </div>
                </a>
                {% empty %}
                <p class="text-muted-foreground text-sm text-center py-4">No recent cases</p>
                {% endfor %}
            </div>
        </div>

        <!-- Critical Cases -->
        <div class="bg-gradient-to-br from-rose-50 to-pink-50 rounded-lg border-2 border-rose-200 p-6 shadow-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-rose-900">Critical Cases</h3>
                <a href="{% url 'case_list' %}?priority=critical" class="text-sm text-rose-600 hover:text-rose-800 hover:underline">View all →</a>
            </div>
            <div class="space-y-3">
                {% for case in critical_cases %}
                <a href="{% url 'case_detail' case.pk %}" class="block p-3 rounded-lg hover:bg-secondary/50 transition-colors">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-foreground">{{ case.case_number }}</p>
                            <p class="text-sm text-muted-foreground">{{ case.case_name }}</p>
                        </div>
                        <span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700">
                            Critical
                        </span>
                    </div>
                </a>
                {% empty %}
                <p class="text-muted-foreground text-sm text-center py-4">No critical cases</p>
                {% endfor %}
            </div>
        </div>
        
        <!-- Recent Evidence -->
        <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-lg border-2 border-amber-200 p-6 shadow-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-amber-900">Recent Evidence</h3>
                <a href="{% url 'evidence_list' %}" class="text-sm text-amber-600 hover:text-amber-800 hover:underline">View all →</a>
            </div>
            <div class="space-y-3">
                {% for item in recent_evidence %}
                <div class="block p-3 rounded-lg hover:bg-secondary/50 transition-colors">
                    <div class="flex items-center justify-between">
                        <div>
                            <a href="{% url 'evidence_detail' item.pk %}" class="font-medium text-primary hover:underline">{{ item.evidence_number }}</a>
                            <p class="text-sm text-muted-foreground">{{ item.item_name }}</p>
                            {% if item.case %}
                            <a href="{% url 'case_detail' item.case.pk %}" class="text-xs text-primary hover:underline">{{ item.case.case_number }}</a>
                            {% endif %}
                        </div>
                        <span class="px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-700">
                            {{ item.get_device_type_display }}
                        </span>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted-foreground text-sm text-center py-4">No recent evidence</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    // Case Status Distribution Chart
    const caseStatusCtx = document.getElementById('caseStatusChart').getContext('2d');
    new Chart(caseStatusCtx, {
        type: 'doughnut',
        data: {
            labels: {{ case_status_labels|safe }},
            datasets: [{
                data: {{ case_status_counts|safe }},
                backgroundColor: [
                    'rgba(34, 197, 94, 0.8)',   // Active - Green
                    'rgba(107, 114, 128, 0.8)',  // Closed - Gray
                    'rgba(234, 179, 8, 0.8)',    // Suspended - Yellow
                    'rgba(59, 130, 246, 0.8)',   // Archived - Blue
                ],
                borderColor: [
                    'rgba(34, 197, 94, 1)',
                    'rgba(107, 114, 128, 1)',
                    'rgba(234, 179, 8, 1)',
                    'rgba(59, 130, 246, 1)',
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });

    // Evidence by Device Type Chart
    const evidenceDeviceCtx = document.getElementById('evidenceDeviceChart').getContext('2d');
    new Chart(evidenceDeviceCtx, {
        type: 'bar',
        data: {
            labels: {{ evidence_device_labels|safe }},
            datasets: [{
                label: 'Evidence Count',
                data: {{ evidence_device_counts|safe }},
                backgroundColor: 'rgba(147, 51, 234, 0.8)',
                borderColor: 'rgba(147, 51, 234, 1)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
</script>
{% endblock %}
